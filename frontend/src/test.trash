import React from "react"
import { DownloadableLink } from "./base"
import { ModList } from "./mod"
import { getUserFromCookie } from "./user"


export default function Home(props) {
    return (
        <div>
            <ModList/>
            <ControlPanel/>
        </div>
    )
}

function ControlPanel(props) {
    return (
        <div className="control-panel">
            <FileUploadBtn path="/api/mods" className="btn" name="file">MOD_UPLOAD</FileUploadBtn>
            <DownloadableLink path="/api/archive/mods" fileName="mods.zip" className="btn" href="">MODS_ARCHIVE</DownloadableLink>
            <DownloadableLink path="/api/archive/data" fileName="server_data.zip" className="btn" href="">DATA_ARCHIVE</DownloadableLink>
            <ReloadServerBtn path="/api/server/reload" className="btn">RELOAD_SERVER</ReloadServerBtn>
        </div>
    )
}

// function ControlBtn(props) {
//     return ()
// }

function FileUploadBtn(props) {
    const {path, name, className, children, ...attr} = props
    function onChange(event) {
        event.preventDefault()
        const formData = new FormData()
        const file = event.target.files[0]
        formData.append('file', file)
        fetch(path, {
            method: "POST",
            body: formData,
            headers: {
                'X-Session-Token': 'Bearer ' + getUserFromCookie().token,
            }
        }).finally(() => {
            window.location.reload()
        })
    }
    return (
        <label className={className} {...attr}>
            <input onChange={onChange} type="file" name={name}/>
            {children}
        </label>
    )
}

function ReloadServerBtn(props) {
    function reload(event) {
		event.preventDefault()
		fetch("/api/server/reload", {
		    method: 'GET',
	    	headers: {
		        'Content-Type': 'application/json',
		    },
	    })
    }
    return (
        <a onClick={reload} className="btn" href="">{props.children}</a>
    )
}